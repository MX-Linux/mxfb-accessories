#!/bin/bash 

## this app is based on one by tenner that can be downloaded at http://tenr.de/snippets/scripts/shot.sh
## it has been modified and expanded for use with MX-Fluxbox
## released under GPLv3

#set up translation

source gettext.sh

export TEXTDOMAIN=mxfb-accessories
export TEXTDOMAINDIR="/usr/share/locale"

## the following parameters are set in ${HOME}/.config/MX-Linux/mxfb-quickshot.conf
#OPTION
#DESTDIR=""
#NAME=""
#TIMEOUT=""
#SUF=""
#PRE=""
#SHOWHELP=""
#SHOWSUCCESS=""

if [ ! "$HOME/.config/MX-Linux/mxfb-quickshot.conf" ]; then 
cp /usr/share/mxfb-quickshot/mxfb-quickshot.conf $HOME/.config/MX-Linux/mxfb-quickshot.conf; 
fi

[ -r "$HOME/.config/user-dirs.dirs" ] && source "$HOME/.config/user-dirs.dirs"
source ${HOME}/.config/MX-Linux/mxfb-quickshot.conf

NOW=$(date +%Y"%m%d")

if [ ! -f $HOME/.restore/MX-Linux/mxfb-quickshot.conf* ]; then
MESSAGE="$(eval_gettext 'This installation will install a new config file \n\nThe existing file will be backed up as \n\n<b>$HOME/.restore/MX-Linux/mxfb-quickshot.conf_$NOW</b>')"

##begin message box
yad --title="$TITLE" --class="$CLASS" --window-icon="$ICONPATH" --width=350 --height=200 --text-align=center --text="\n\n$MESSAGE\n\n" --text-align=center --center --borders=20 --button="gtk-cancel":7 --button="$(gettext 'OK to proceed?')":6

if [ ! "$?" = "6" ]; then
exit 0
		
else

mkdir -p $HOME/.restore/MX-Linux/
cp $HOME/.config/MX-Linux/mxfb-quickshot.conf $HOME/.restore/MX-Linux/mxfb-quickshot.conf_$(date -d "today" +"%Y%m%d")

fi
fi

if [ $SHOWHELP = "yes" ]; then	
	yad  --title="Usage" --window-icon /usr/share/icons/ePapirus/16x16/categories/accessories-screenshot.svg --timeout=9 --no-buttons \
	--text-align=center --width=200 --height=200 --fixed \
    --text=" \n\n\n
<big>$(eval_gettext 'MODES    \n 
<b>Active Window</b>: press Print and click anywhere \n
<b>Selection</b>: press Print and draw rectangle \n
<b>Desktop</b>: press Shift + Print \n\n

PREFERENCES \n
$HOME/.config/MX-Linux/mxfb-quickshot.conf \n
<b>>>Hide Usage message</b>: <i>SHOWHELP='no'</i> \n
<b>>>Hide Success message</b>: <i>SHOWSUCCESS='no'</i>')</big>"
fi

display_help() {
	cat << EOF
	Usage: `basename "$0"` [-r/r/-w/w/-b/b/-u/u] [-png|png|-jpg|jpg]
EOF
}

take_shot() {
	scrot ${OPTION} "${PRE}${NAME}.${SUF}" -e 'mv $f '$DESTDIR''
if [ $? -eq 2 ] ; then
    echo "exiting, no image selected"
    exit 1
fi

if [ $? -eq 1 ] ; then
    exit 1
fi
}

if [ $# -gt 2 ]
then
	display_help
	exit 1
elif [ $# -eq 0 ]
then
	take_shot
if [ $SHOWSUCCESS = "yes" ]; then	
	yad  --title="$(gettext 'Success!')" --timeout=$TIMEOUT --no-buttons \
	--borders=20 --text-align=center --width=200 --height=200 --margins=20 --fixed --text " \n\n\n
	<big><b>$(eval_gettext 'Location'): $DESTDIR </b>\n
	$(gettext 'Name'): <i>${PRE}${NAME}.${SUF}</i></big> \n \n 
	----- \n
	$(gettext 'Options'): $HOME/.config/MX-Linux/mxfb-quickshot.conf"
fi
exit 0
else
	case "$1" in
		-r|r|-R|R|root|Root|-root|-Root)
			OPTION=""
			;;		
		-u|u|-U|U|focused|Focused|-focused|-Focused)
			OPTION="-u"
			;;
		*)
			display_help
			exit 1
	esac

	case "$2" in
		jpg|JPG|-jpg|-JPG)
			SUF="jpg"
			;;	
		png|PNG|-png|-PNG)
			SUF="png"
			;;
		*)
			display_help
			exit 1
	esac
	take_shot
	exit 0
fi
